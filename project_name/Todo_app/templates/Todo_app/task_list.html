{% extends "Todo_app/index.html" %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task List</title>
</head>
<body>
    
{% block content %}
<div class="container">
    <h1 class="mt-4 text-primary">Task List</h1>
    <h6 class="mt-5 border text-start fst-italic text-primary p-2" data-bs-toggle="collapse" href="#taskCollapse1" aria-expanded="false" aria-controls="taskCollapse1">
        + Add a task
    </h6>
    <form method="POST" action="{% url 'add_task' task_list_id %}" style="width: 100%; margin: 0 auto;" class="collapse" id="taskCollapse1">
        {% csrf_token %}        
        <div style="position: relative;">
            <textarea id="description" name="description" required class="form-control mb-3" style="padding-right: 40px;"></textarea>
            <input type="hidden" name="important" value="True">
            <button type="submit" class="btn btn-primary" style="position: absolute; top: 0; right: 5px; height: 100%; min-width: 50px;">+</button>
        </div>
    </form> 

    <ul id="task-list" class="list-group">
        {% for task in tasks %}
        <li class="task-list-item {% if task.completed %}completed{% endif %}" id="task{{ task.id }}">
            <form action="{% url 'mark_task_as_completed' task.id %}" method="POST">
                {% csrf_token %}
                <input type="hidden" name="task_id" value="{{ task.id }}">
                <input type="radio" name="incompleteTask" onclick="markAsIncomplete('{{ task.id }}')" class="form-check-input me-2">
                {{ task.description }}
                <small class="text-muted">{{ task.created_at }}</small>
            </form>
        </li>
        
        {% endfor %}
        <h5 class="mt-5 border  p-2" data-bs-toggle="collapse" href="#taskCollapse2" aria-expanded="false" aria-controls="taskCollapse2">
            Complete 
       </h5>
       <ul class="list-group collapse" id="taskCollapse2">
           {% for task in tasks_compelte %}
           <li class="task-list-item {% if task.completed %}completed{% endif %}" id="task{{ task.id }}">
               <input type="radio" name="incompleteTask" onclick="markAsIncomplete('{{ task.id }}')" class="form-check-input me-2">
               {{ task.description }}
               <small class="text-muted">{{ task.created_at }}</small>
           </li>
           {% endfor %}

    </ul> 
</div>
{% endblock content %}
<script>
    // Function to toggle task completion
    function toggleTask(taskId) {
        var taskElement = document.querySelector(`li[data-task-id="${taskId}"]`);
        taskElement.classList.toggle('completed');
    }

    // Function to fetch tasks and add them to the list
    function fetchTasks(taskListId) {
        fetch(`/api/tasks/${taskListId}/`)
            .then(response => response.json())
            .then(data => {
                const taskList = document.getElementById('task-list');
                data.forEach(task => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item';
                    listItem.dataset.taskId = task.id;
                    listItem.textContent = task.description;
                    listItem.addEventListener('click', () => toggleTask(task.id));
                    taskList.appendChild(listItem);
                });
            })
            .catch(error => console.error('Error fetching tasks:', error));
    }

    // Call fetchTasks function when the page is loaded
    window.addEventListener('load', () => {
        fetchTasks('your-task-list-id'); // Replace 'your-task-list-id' with the actual ID of your task list
    });
    
    

    function markAsIncomplete(taskId) {
        fetch(`/mark-as-incomplete/${taskId}/`, {
        })
        .then(response => {
            if (response.ok) {
                location.reload();
            } else {
                console.error('Failed to mark task as incomplete.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function markAsComplete(taskId) {
        var taskElement = document.getElementById('task' + taskId);
        taskElement.classList.add('completed');
        taskElement.querySelector('input[type="radio"]').remove();
        taskElement.classList.remove('task-list-item');
        taskElement.classList.add('complete-list-item');
        document.getElementById('completeList').appendChild(taskElement);
        fetch('/mark_completed/' + taskId + '/')
            .then(response => {
                if (response.ok) {
                    location.reload();

                    console.log('Task marked as completed successfully');
                } else {
                    console.error('Failed to mark task as completed');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    function mark_important(taskId) {
        fetch('/mark_important/' + taskId + '/')
            .then(response => {
                if (response.ok) {
                    location.reload();

                    console.log('Task marked as important successfully');
                } else {
                    console.error('Failed to mark task as important');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

</script>


</body>
</html>
